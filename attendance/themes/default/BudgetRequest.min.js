function GLAccountAssignment(e) {
    var t = e.children("tbody").children("tr");
    t.each(function() {
        var e = $(this),
            t = e.attr("data-item-id");
        if ("undefined" == typeof t) return !0;
        var a = e.find('[name="gl-items[]"]');
        a.length && a.each(function() {
            var e = $(this).siblings(".icon-erp-clickable.icon-erp-x-dark");
            e.click(function() {
                e.parent().remove()
            })
        });
        var i = e.children("td:first-child").html(),
            n = e.find(".gl-link"),
            r = n.parent();
        n.wrap('<a class="display-inline-block" href="#GLLink">'), n = n.parent("a"), n.css("border-bottom", "1px solid #ccd1ff").click(function(e) {
            e.preventDefault(), modalContainer('Please specify below the GL Account information for the item <div style="margin: 5px 0px; font-size: 1.15em;">' + i + '</div><input id="gl-account-code" type="text" name="gl-account-code" placeholder="GL Account Code/Name" /><select name="gl-transact-type"><option>Credit</option><option>Debit</option></select><div id="preview-added-gl-accounts"></div>', "GL Account Code Assignment");
            var a = $("#preview-added-gl-accounts");
            a.css({
                "margin-top": "15px"
            }).html(r.html()).find('a, input[type="hidden"], .icon-erp-clickable').remove();
            var n = $("#gl-account-code"),
                o = $('select[name="gl-transact-type"]');
            n.focus(), textboxSearch(n, {
                url: URL_BASE + "ERPModule/GLAccounts/Actions/Search/"
            }, function(e) {
                var i = o.val();
                r.append('<div style="padding-top: 10px; border-bottom: 1px solid #ccd1ff;"><div class="icon-erp-clickable icon-erp-x-dark"></div> <input type="hidden" name="gl-items[]" value="' + t + '" /><input type="hidden" name="gl-accounts[]" value="' + e.Code + '" /><input type="hidden" name="gl-trans-types[]" value="' + i.toLowerCase() + '" />' + e.display + " [" + i + "]</div>"), n.val("").focus();
                var l = r.children("div:last-child");
                l.children(".icon-erp-clickable").click(function() {
                    l.remove()
                }), a.html(r.html()).find('a, input[type="hidden"], .icon-erp-clickable').remove()
            })
        })
    })
}

function digitalLogbook() {
    var e = $("#budgetrequestlogbooktable");
    if (!e.length) return !0;
    var t = (e.children("thead"), e.children("tbody")),
        a = e.children("tfoot"),
        i = a.html('<tr><td colspan="7"></td></tr>').children("tr").children("td"),
        n = URL_BASE + "ERPModule/Requests/Budgets/DigitalLogbook/Actions/ListMyRequests/",
        r = function(e) {
            t.html("").stop().animate({
                "background-color": "transparent"
            }, 400), $.each(e, function(e, a) {
                var i = "",
                    n = "N/A",
                    r = a[0],
                    o = "",
                    l = "",
                    s = "",
                    d = "",
                    c = "",
                    u = "",
                    p = "",
                    f = "";
                switch (a[3]) {
                    case "1":
                        i = "of the Department Head", n = "For Approval";
                        break;
                    case "2":
                        i = "of the Executive Director", n = "For Approval";
                        break;
                    case "3":
                        i = "of the Materiel Management Officer", n = "For Approval";
                        break;
                    case "4":
                        i = "of the Chief Finance Officer", n = "For Approval";
                        break;
                    case "5":
                        i = "from the Requestor", n = "Revision";
                        break;
                    case "6":
                        n = "Approved";
                        break;
                    case "7":
                        n = "Cancelled";
                        break;
                    case "0":
                    default:
                        if (n = "Unknown", "new" === a[3].substr(0, 3)) {
                            var m = a[3].split(":::"),
                                h = m[1].split("<br />");
                            h = h[0].split("of"), h = $.trim(h[1]), i = 'of <div class="display-inline-block" style="text-transform: uppercase;">' + h + "</div>", n = "For Approval"
                        }
                }
                i = renderProgressBar(a[12], n) + '<div class="display-inline-block" style="margin-left: 5px;">' + i + "</div>";
                var v = a[10];
                "N/A" !== v && (v = JSON.parse(v), v = v.PHP > 0 && v.USD > 0 ? "P " + number_format(v.PHP, 2) + "<br />$ " + number_format(v.USD, 2) : v.PHP > 0 && 0 == v.USD ? "P " + number_format(v.PHP, 2) : "$ " + number_format(v.USD, 2));
                var g = 40,
                    b = a[11].length > g ? a[11].substr(0, g - 3) + "..." : a[11],
                    y = 1 == a[4] ? ' data-isrequestor="1"' : "";
                l = ' <div class="display-inline-block white-space-nowrap">| <a href="' + URLModules + "/BudgetRequest.php?print=" + r + '" target="_blank">Print</a></div>', (1 == a[4] && 6 != a[3] && 7 != a[3] || 1 == a[5] && 6 != a[3] && 7 != a[3]) && (s = ' <div class="display-inline-block white-space-nowrap">| <a href="' + URLRoot + "/Requests/Budget/Revise/" + r + '/">Revise</a></div>', c.length <= 0 && (c = ' <div class="display-inline-block white-space-nowrap">| <a href="' + URLModules + "/BudgetRequest.php?cancel=" + r + '" target="_blank">Cancel</a></div>')), 6 != a[3] && 7 != a[3] && (f = ' <div class="display-inline-block white-space-nowrap">| <a class="btn-follow-up" href="' + URLRoot + "/Requests/Budget/FollowUp/" + r + '/" target="_blank">Follow Up</a></div>'), o = '<tr style="border-bottom: 1px solid #ccc;" data-requestid="' + a[0] + '"' + y + '><td class="align-right white-space-nowrap">' + r + "</td><td>" + a[1] + "</td><td>" + a[2] + '</td><td class="white-space-nowrap">' + i + '</td><td class="align-right white-space-nowrap">' + v + '</td><td><div class="reqdet">' + b + '</div></td><td><a href="#View">View</a>' + s + d + c + u + p + l + f, t.append(o);
                var x = t.children("tr:last-child"),
                    b = x.find(".reqdet");
                x.find('a[href="#View"]').click(function(e) {
                    e.preventDefault(), modalContainer("Loading BR#" + r, "Please wait...", {}), $.ajax({
                        url: URLModules + "/BudgetRequestLogbook.php",
                        type: "post",
                        data: {
                            requestType: "requestContents",
                            requestNo: r
                        },
                        success: function(e) {
                            modalContainer(e, "BR#" + r + " - Information")
                        },
                        error: function() {
                            modalContainer("Failed to contact the server to display the information of BR#" + r, "Notification of Error")
                        }
                    })
                }), x.find(".btn-follow-up").click(function(e) {
                    e.preventDefault();
                    var t = $(this);
                    modalContainer("BR#<b>" + r + "</b>, do you want to send a follow up and notification email?", "Confirm Follow Up", {
                        "Yes, send a follow up": function() {
                            $.ajax({
                                url: t.attr("href"),
                                success: function() {
                                    modalContainer('<h3 class="margin-none margin-bottom">BR#<b>' + a[0] + '</b> Follow up has been sent !</h3><div style="max-width: 420px;">An email notification and follow up approval has been sent, please check your email. There might be a little delay but if it takes a day or more, please notify your I.T. department that you are not receiving your email notifications for LormaERP Budget Request module.</div>', "Notice")
                                },
                                error: function() {
                                    modalContainer("The system failed to send the email notification.", "Error")
                                }
                            })
                        },
                        No: ""
                    })
                }), a[11].length > g && b.tooltip(a[11])
            })
        };
    $.ajax({
        url: n,
        type: "post",
        data: {
            noOfPages: ""
        },
        success: function(e) {
            var a = parseInt(e);
            if (0 == a) return t.html('<tr><td colspan="' + i.attr("colspan") + '">There are no budget requests to show.</td></tr>'), !0;
            i.html("");
            for (var o = 1; a >= o; o++) i.prepend('<div class="page">' + o + "</div>");
            i.children(".page").click(function() {
                var e = $(this),
                    a = parseInt(e.html());
                return e.hasClass("selected") ? !0 : (i.children(".selected").removeClass("selected"), e.addClass("selected"), t.find("a").remove(), t.stop().animate({
                    "background-color": "#ffe5e5"
                }, 400), void $.ajax({
                    url: n,
                    type: "post",
                    data: {
                        page: a
                    },
                    success: function(e) {
                        if (!e.length) return console.log("There are no requests to show."), !0;
                        var t = JSON.parse(e);
                        r(t)
                    }
                }))
            }), i.children(".page:first-child").trigger("click"), minimizePageNavigator(i)
        }
    })
}

function digitalLogbookFilter(e) {
    var t = $("#budgetrequestlogbooktable");
    if (!t.length) return !0;
    var a = (t.children("thead"), t.children("tbody")),
        i = t.children("tfoot"),
        n = i.html('<tr><td colspan="7"></td></tr>').children("tr").children("td"),
        r = URL_BASE + "ERPModule/Requests/Budgets/DigitalLogbook/Actions/ListMyRequestsByFilter/";
    e.change(function() {
        var i = e.val();
        n.html("");
        var o = {
                url: r,
                filter: {
                    department: i
                }
            },
            l = function(e) {
                digitalLogbookLoadTblRows(e, a)
            };
        renderTablePagination(t, o, l, !0)
    })
}

function digitalLogbookLoadTblRows(e, t) {
    var a = "",
        i = "N/A",
        n = e[0],
        r = "",
        o = "",
        l = "",
        s = "",
        d = "",
        c = "",
        u = "",
        p = "",
        f = "";
    switch (e[3]) {
        case "1":
            a = "of the Department Head", i = "For Approval";
            break;
        case "2":
            a = "of the Executive Director", i = "For Approval";
            break;
        case "3":
            a = "of the Materiel Management Officer", i = "For Approval";
            break;
        case "4":
            a = "of the Chief Finance Officer", i = "For Approval";
            break;
        case "5":
            a = "from the Requestor", i = "Revision";
            break;
        case "6":
            i = "Approved";
            break;
        case "7":
            i = "Cancelled";
            break;
        case "0":
        default:
            if (i = "Unknown", "new" === e[3].substr(0, 3)) {
                var m = e[3].split(":::"),
                    h = m[1].split("<br />");
                h = h[0].split("of"), h = $.trim(h[1]), a = 'of <div class="display-inline-block" style="text-transform: uppercase;">' + h + "</div>", i = "For Approval"
            }
    }
    a = renderProgressBar(e[12], i) + '<div class="display-inline-block" style="margin-left: 5px;">' + a + "</div>";
    var v = e[10];
    "N/A" !== v && (v = JSON.parse(v), v = v.PHP > 0 && v.USD > 0 ? "P " + number_format(v.PHP, 2) + "<br />$ " + number_format(v.USD, 2) : v.PHP > 0 && 0 == v.USD ? "P " + number_format(v.PHP, 2) : "$ " + number_format(v.USD, 2));
    var g = 40,
        b = e[11].length > g ? e[11].substr(0, g - 3) + "..." : e[11],
        y = 1 == e[4] ? ' data-isrequestor="1"' : "";
    o = ' <div class="display-inline-block white-space-nowrap">| <a href="' + URLModules + "/BudgetRequest.php?print=" + n + '" target="_blank">Print</a></div>', (1 == e[4] && 6 != e[3] && 7 != e[3] || 1 == e[5] && 6 != e[3] && 7 != e[3]) && (l = ' <div class="display-inline-block white-space-nowrap">| <a href="' + URLRoot + "/Requests/Budget/Revise/" + n + '/">Revise</a></div>', d.length <= 0 && (d = ' <div class="display-inline-block white-space-nowrap">| <a href="' + URLModules + "/BudgetRequest.php?cancel=" + n + '" target="_blank">Cancel</a></div>')), "isAdmin" === e[13] && (f += ' <div class="display-inline-block white-space-nowrap">| <a class="reset_action" href="' + URLRoot + "/Requests/Budget/Reset/" + n + '/" target="_blank">Reset</a></div>'), 6 != e[3] && 7 != e[3] && (p = ' <div class="display-inline-block white-space-nowrap">| <a class="btn-follow-up" href="' + URLRoot + "/Requests/Budget/FollowUp/" + n + '/" target="_blank">Follow Up</a></div>'), r = '<tr style="border-bottom: 1px solid #ccc;" data-requestid="' + e[0] + '"' + y + '><td class="align-right white-space-nowrap">' + n + "</td><td>" + e[1] + "</td><td>" + e[2] + '</td><td class="req_status_container white-space-nowrap">' + a + '</td><td class="align-right white-space-nowrap">' + v + '</td><td><div class="reqdet">' + b + '</div></td><td><a href="#View">View</a>' + l + s + d + c + u + o + p + f + "</td></tr>", t.append(r);
    var x = t.children("tr:last-child"),
        b = x.find(".reqdet"),
        _ = x.find('a[href="#View"]'),
        w = x.find(".btn-follow-up"),
        k = x.find(".reset_action");
    _.click(function(e) {
        e.preventDefault(), modalContainer("Loading BR#" + n, "Please wait...", {}), $.ajax({
            url: URLModules + "/BudgetRequestLogbook.php",
            type: "post",
            data: {
                requestType: "requestContents",
                requestNo: n
            },
            success: function(e) {
                modalContainer(e, "Budget Request #" + n + " - Information")
            },
            error: function() {
                modalContainer("Failed to contact the server to display the information of Budget Request #" + n, "Notification of Error")
            }
        })
    }), w.click(function(t) {
        t.preventDefault();
        var a = $(this);
        modalContainer("BR#<b>" + n + "</b>, do you want to send a follow up and notification email?", "Confirm Follow Up", {
            "Yes, send a follow up": function() {
                $.ajax({
                    url: a.attr("href"),
                    success: function() {
                        modalContainer('<h3 class="margin-none margin-bottom">BR#<b>' + e[0] + '</b> Follow up has been sent !</h3><div style="max-width: 420px;">An email notification and follow up approval has been sent, please check your email. There might be a little delay but if it takes a day or more, please notify your I.T. department that you are not receiving your email notifications for LormaERP Budget Request module.</div>', "Notice")
                    },
                    error: function() {
                        modalContainer("The system failed to send the email notification.", "Error")
                    }
                })
            },
            No: ""
        })
    }), k.click(function(e) {
        return e.preventDefault(), k.is(":visible") ? (k.closest("div").hide(0), void modalContainer("Please confirm that you want to reset Budget Request # " + n + ".", "Reset Action Confirmation", {
            Reset: function() {
                $.ajax({
                    url: k.attr("href"),
                    type: "post",
                    data: {
                        ajaxRequest: !0
                    },
                    success: function(e) {
                        "success" === e ? (colorBlink(x, "#07af2e", "#fff"), x.find(".req_status_container").html("This request has been reset.")) : (colorBlink(x, "#b20707", "#fff"), k.closest("div").show(0))
                    },
                    error: function() {
                        modalContainer("Failed to establish connection with the server for resetting the Budget Request.", "Reset Error for Budget Request # " + n), k.closest("div").show(0)
                    }
                })
            },
            Cancel: function() {
                k.closest("div").show(0)
            }
        })) : !1
    }), e[11].length > g && b.tooltip(e[11])
}

function digitalLogbookSearch(e) {
    var t = e.siblings('input[type="button"]'),
        a = $("#budgetrequestlogbooktable");
    if (!a.length) return !0;
    var i = (a.children("thead"), a.children("tbody")),
        n = a.children("tfoot"),
        r = n.html('<tr><td colspan="7"></td></tr>').children("tr").children("td"),
        o = URL_BASE + "ERPModule/Requests/Budgets/DigitalLogbook/Actions/ListMyRequestsBySearch/";
    t.click(function() {
        var t = e.val();
        r.html("");
        var n = {
                url: o,
                filter: {
                    search: t
                }
            },
            l = function(e) {
                digitalLogbookLoadTblRows(e, i)
            };
        renderTablePagination(a, n, l, !0)
    }).trigger("click"), e.keydown(function(e) {
        var a = e.which;
        "13" != a && 13 != a || t.trigger("click")
    })
}

function requestForm() {
    var e = $("#budgetRequestForm"),
        t = $("#formLoadingNotif");
    if (!e.length) return !1;
    e.is(":visible") || (e.show(0), t.length && t.remove());
    var a = e.find("#allocationsContainer"),
        i = a.html(),
        n = e.find("#uploadsPreviewContainer"),
        r = e.find("#uploadsContainer"),
        o = function() {
            a.append(i);
            var e = a.children(".allocations:last-child");
            e.find(".datepicker").removeAttr("id").removeClass("hasDatepicker").datepicker("destroy");
            var t = e.find('[name="details[]"]'),
                n = null;
            t.focusin(function() {
                var e = $.trim(t.val()).length;
                t.attr("data-hascontents", "yes"), 0 >= e && (o(), l())
            }).focusout(function() {
                var a = $.trim(t.val()).length;
                0 >= a && (t.attr("data-hascontents", "no"), e.remove(), l())
            }).on("keyup change", function() {
                $.trim(t.val()).length;
                clearTimeout(n), n = setTimeout(function() {
                    l()
                }, 300)
            });
            var r = e.find('[name="datefrom[]"]'),
                s = e.find('[name="dateuntil[]"]');
            dateRangeRestrict(r, s), e.find('[name="amountrequested[]"], [name="amountcurrency[]"]').on("keyup change", function() {
                l()
            }), e.find('[name="category[]"]').change(function() {
                var e = $(this);
                "others" == e.val() && (e.after('<input type="text" name="category[]" style="width: 125px;" />'), e.next('[name="category[]"]').focus(), e.remove())
            });
            var d = e.find(".alloc-remove");
            d.click(function(a) {
                a.preventDefault(), "yes" == t.attr("data-hascontents") && (e.remove(), l())
            }), e.find(".hasInputBox, .hasDatepickerInitialize, .hasNumeric").removeClass("hasInputBox hasDatepickerInitialize hasNumeric"), e.find('[name="datefrom[]"], [name="dateuntil[]"], [name="amountrequested[]"], [name="amountcurrency[]"], [name="category[]"]').on("keyup change", function() {
                var e = $(this),
                    t = e.attr("name"),
                    i = e.val(),
                    n = a.children("div.allocations:last-child");
                n.find('[name="' + t + '"]').val(i), "datefrom[]" === t && n.find('[name="dateuntil[]"]').val(i)
            });
            var c = a.children(".allocations").length - 1,
                u = a.children(".allocations:nth-child(" + c + ")");
            u.find('[name="datefrom[]"],[name="dateuntil[]"],[name="amountrequested[]"],[name="amountcurrency[]"],[name="category[]"]').each(function() {
                var t = $(this),
                    a = t.attr("name"),
                    i = t.val();
                e.find('[name="' + a + '"]').val(i)
            }), bootstrap_initiatives()
        },
        l = function() {
            var e = 0,
                t = 0;
            a.find('[name="amountrequested[]"]').each(function() {
                var a = $(this),
                    i = a.parent().find('[name="amountcurrency[]"]'),
                    n = a.closest(".allocations").find('[name="details[]"]');
                $.trim(n.val()).length > 0 && ("PHP" == i.val() ? t += parseFloat(a.val()) : "USD" == i.val() && (e += parseFloat(a.val())))
            }), a.parent().find("#allocationTotalAmount").html("P " + number_format(t, 2, ".", ",") + "<br />$ " + number_format(e, 2, ".", ","))
        },
        s = function() {
            r.append('<div style="margin-bottom:2px;"><span class="inlineBlock alignLeft highlight" style="min-height:15px;"><input class="fileUploader" type="file" name="supportingfiles[]" data-hasfile="no" style="vertical-align:middle;" multiple="multiple" /><a class="uploadRemover" href="#" target="_self" class="inlineBlock" style="display:inline-block; margin-left:5px; vertical-align:middle;"><img src="' + URLBase + '/images/icons/x-red.png" /></a></span></div>');
            var e = r.children("div:last-child"),
                t = e.find(".uploadRemover");
            t.hide(0), e.find(".fileUploader").unbind().change(function() {
                var a = $(this);
                a.val().length > 0 ? (a.attr("data-hasfile", "yes"), t.show(0)) : e.remove(), r.find('[data-hasfile="no"]').length < 1 && s()
            }), t.click(function(t) {
                t.preventDefault(), e.remove(), r.find('[data-hasfile="no"]').length < 1 && s()
            })
        };
    a.html(""), o(), s(), n.css({
        display: "block",
        padding: "10px 15px",
        "margin-bottom": "10px",
        border: "1px solid #4c4c4c",
        background: "#666",
        background: "linear-gradient(to bottom, #666, #4c4c4c)",
        color: "#fff"
    }).before('<div style="max-width: ' + a.width() + 'px; margin-bottom: 10px;"><h3 style="margin: 0px 0px 10px 0px; font-weight: normal;">Guidelines (<div style="display: inline; color: #e20b0b;">Please read</div>):</h3><div id="supporting-files-advise-container" style="white-space: nowrap;"><div class="supporting-files-advise" style="display: inline-block; vertical-align: top; white-space: normal; overflow-wrap: break-word;"><ul><li>Name the file(s) appropriately before uploading it here in the system.</li><li>These files will be uploaded directly to your Google Drive, please <div style="display: inline; color: #e20b0b;">do not delete</div> these files.</li><li>The filesize of each file shall be less than 2MB.</li><li>The overall total filesize shall not exceed 8MB.</li><li>All file types are accepted (PDF, Images, MS Office Documents, and Others).</li></ul></div><div class="supporting-files-advise" style="display: inline-block; margin-left: 10px; padding-left: 10px; border-left: 1px solid #333; vertical-align: top; white-space: normal; overflow-wrap: break-word;">In some cases, you\'re requested to upload the following documents if the Budget Request is related to affiliation fees and such:<ul><li>Contract or Memorandum Of Agreement</li><li>Statement Of Account</li><li>Multipaged documents shall have page numbers.</li><li>As much as possible, these documents shall have the following information:<ul><li>Signatures with Printed Name</li><li>Dates</li><li>Contact Numbers</li><li>Address</li></ul></li></ul></div></div><div style="margin-bottom: 20px;">If you have any queries, you may send an email to <a href="mailto:sysdev@lorma.edu" target="_blank">sysdev@lorma.edu</a> for assistance.</div></div>').html("No uploads yet");
    var d = n.prev("div").find("#supporting-files-advise-container");
    if (d.find(".supporting-files-advise").each(function() {
            var e = $(this);
            e.css({
                "max-width": a.width() / 2 - 10 + "px"
            })
        }), 0 != e.attr("data-requestno")) {
        var c = e.attr("data-requestno");
        $.ajax({
            url: URLModules + "/BudgetRequest.php",
            type: "post",
            data: {
                brJSON: c
            },
            success: function(t) {
                try {
                    var i = JSON.parse(t),
                        r = i.b,
                        s = i.a,
                        d = i.i,
                        u = i.o;
                    GDriveUploads = i.GDrive
                } catch (p) {
                    return console.error("Error BR#" + c + ": " + p), !1
                }
                $('select[name="is_travel_request_selector"]').closest("div").hide(0).after("<div></div>").next("div").css({
                    color: "#006ac1"
                }).html("NOTE: This is a Budget Request and you can no longer revise this request into a Travel Request.<br />Should you wish to create a Travel Request with the same information, cancel this request and create a new Travel Request."), e.find('[name="department"]').val(r[0]), e.find('[name="requestdetails"]').val(r[1]), $.each(s, function(e) {
                    var t = a.find(".allocations:last-child"),
                        i = s[e];
                    t.find('[name="datefrom[]"]').val(i[2]).trigger("change"), t.find('[name="dateuntil[]"]').val(i[3]), t.find('[name="amountrequested[]"]').val(number_format(i[6], 2, ".", "")), t.find('[name="amountcurrency[]"]').val(i[7]), t.find('[name="category[]"]').val(i[5]), t.find('[name="details[]"]').val(i[4]).trigger("focusin").trigger("focusout"), o()
                });
                var f = [];
                d.length > 0 && (n.html(""), $.each(d, function(e, t) {
                    f.push({
                        fileLink: URLBase + "/files/BudgetRequest/BR-" + c + "/SupportingFiles/" + t,
                        filename: t,
                        uploadDateTime: ""
                    })
                })), u.length > 0 && (d.length < 1 && n.html(""), $.each(u, function(e, t) {
                    f.push({
                        fileLink: URLBase + "/files/BudgetRequest/BR-" + c + "/SupportingFiles/" + t,
                        filename: t,
                        uploadDateTime: ""
                    })
                })), $.each(GDriveUploads, function(e, t) {
                    f.push({
                        fileID: t.id,
                        fileID_google: t.upload_file_id,
                        fileLink: "https://drive.google.com/file/d/" + t.upload_file_id + "/view?usp=sharing",
                        filename: t.upload_filename,
                        uploadDateTime: t.upload_datetime
                    })
                }), n.hide(0), $.each(f, function(e, t) {
                    n.is(":visible") || n.html('<div class="instruction" style="margin-bottom: 20px; border-bottom: 1px solid #d8d8d8;">Click the filename to view/download the file.</div>').css({
                        background: "#fff",
                        "border-color": "#d8d8d8",
                        color: "#333"
                    }).show(0);
                    var a = "undefined",
                        i = typeof t.fileID != a ? t.fileID : 0,
                        r = typeof t.fileID_google != a ? t.fileID_google : 0;
                    n.append('<div style="margin-bottom: 2px;"><input class="btnDeleteFile" type="button" data-fileid="' + i + '" data-fileid-google="' + r + '" data-filename="' + t.filename + '" value="Delete" /> <a href="' + t.fileLink + '" target="_blank" title="Uploaded at ' + t.uploadDateTime + '">' + t.filename + "</a></div>")
                }), n.find(".btnDeleteFile").css({
                    "margin-right": "10px",
                    padding: "1px 8px",
                    "vertical-align": "middle"
                }).click(function() {
                    var e = $(this),
                        t = e.closest("div"),
                        a = e.attr("data-filename"),
                        i = e.attr("data-fileid"),
                        r = e.attr("data-fileid-google");
                    "undefined" != i && "undefined" != typeof i || (i = 0), modalContainer("Do you wish to delete the file " + a + ".", "Confirm Action", {
                        "Delete File": function() {
                            $.ajax({
                                url: URLModules + "/BudgetRequest.php",
                                type: "post",
                                data: {
                                    requestType: "fileDelete",
                                    fileID: i,
                                    fileID_google: r,
                                    filename: a,
                                    requestNo: c
                                },
                                success: function(e) {
                                    "success" === e ? (t.remove(), n.children("div:not(.instruction)").length || n.html("There are no more uploaded files.")) : console.error("Failed to delete the file " + a + ".")
                                }
                            })
                        },
                        Cancel: ""
                    })
                }), "undefined" != typeof i.tr ? (requestForm_travelRequestUpdate(i.tr), e.find('input[type="submit"]').val("Update Travel Request")) : e.find('input[type="submit"]').val("Update Budget Request"), l(), e.append('<input type="hidden" name="budgetid" value="' + c + '" />')
            }
        })
    }
    e.find('[type="submit"]').hasClass("confirmButton") && e.find('[type="submit"]').unbind().removeClass("confirmButton");
    var u = function() {
            var e = 0,
                t = !0,
                i = !1,
                n = {};
            return a.find('[name="details[]"]').each(function() {
                var a = $(this);
                if ($.trim(a.val()).length > 0) {
                    e++;
                    var i = a.closest(".allocations"),
                        n = i.find('[name="category[]"]'),
                        r = i.find('[name="datefrom[]"]'),
                        o = i.find('[name="dateuntil[]"]');
                    (n.val().length < 1 || "0000-00-00" == r.val() || "0000-00-00" == o.val()) && (t = !1)
                }
            }), a.find('[name="category[]"]').each(function() {
                var e = $(this),
                    t = $.trim(e.val()),
                    a = e.closest(".allocations"),
                    r = a.find('[name="details[]"]');
                if (!$.trim(r.val()).length) return !0;
                var o = t.toLowerCase().replace(" ", "");
                (o.indexOf("fare") > -1 || o.indexOf("travel") > -1 || o.indexOf("transpo") > -1 || o.indexOf("taxi") > -1 || o.indexOf("fieldtrip") > -1) && (i !== !0 && (i = !0), "undefined" == typeof n[t] && (n[t] = []), n[t].push($.trim(r.val())))
            }), t === !1 ? (modalContainer("All Budget Allocations that contains a Narrative Details must contain the following:<ol><li>From date</li><li>Until date</li><li>Type of Expense</li></ol>Please check your form. Thank you.", "Error Notice"), !1) : 0 >= e ? (modalContainer("Please provide at least 1 Budget Allocation on the form.", "Error Notice"), !1) : i === !0 ? {
                hasFare: !0,
                travelRelated_expenses: n
            } : !0
        },
        p = function() {
            var e = $("#fieldset-travel-request"),
                t = e.find("#travel_title");
            if (!$.trim(t.val()).length) return modalContainer("Please provide a Title for your Travel Request.", "Error Notice"), !1;
            var a = e.find('[name="venue[]"]').closest("table"),
                i = 0,
                n = [],
                r = 0;
            return a.find('[name="venue[]"]').each(function() {
                var e = $(this);
                if (!$.trim(e.val()).length) return !0;
                i++;
                var t = e.closest("tr"),
                    a = t.find('[name="date_from[]"]'),
                    o = t.find('[name="date_to[]"]');
                $.each([a, o], function(t, a) {
                    var i = $.trim(a.val());
                    "0000-00-00" !== i && "" !== i && null !== i || (n.push(e.val()), r++)
                })
            }), 0 >= i ? (modalContainer("You're required to provide at least 1 venue for your Travel Request.", "Error Notice"), !1) : r > 0 ? (modalContainer("You have provided travel venues that doesn't have dates. If you are unsure with the dates, you may provide tentative dates.", "Error Notice"), !1) : !0
        },
        f = function() {
            modalContainer("Sending your Budget Request to the server, please wait..."), setTimeout(function() {
                submitForm(e, function(t) {
                    var a = t.split(" ");
                    if ("success" == a[0]) modalContainerClose(), e.slideUp("fast", function() {
                        e.after('<div id="request-result"></div>'), $.ajax({
                            url: e.attr("action"),
                            type: "post",
                            data: {
                                br: a[1]
                            },
                            success: function(t) {
                                e.siblings('input[type="button"][value="Open Wizard"]').remove(), e.remove(), $("#request-result").html(t), $("#request-result").before('<div class="margin-top margin-bottom"><div class="margin-bottom">If you are reading this, your form submission is <b>SUCCESSFUL!</b></div><b>WHAT TO DO NEXT?</b><br /><ul><li>Notify your Department Head to immediately check their email then approve the request.</li><li>Wait for the request to be fully approved.</li><li>Send us your Feedback via email to <a href="mailto:sysdev@lorma.edu">sysdev@lorma.edu</a>.</li></ul></div>')
                            }
                        })
                    });
                    else {
                        modalContainer('You might have committed error(s) in the form.<br />Please check then try again.<div class="margin-top">You might want to try using the wizard, <a href="#">click here</a></div>');
                        var i = $("#modal-container"),
                            n = i.find("a");
                        n.click(function(e) {
                            e.preventDefault(), $('input[type="button"][value="Open Wizard"]').length && $('input[type="button"][value="Open Wizard"]').trigger("click")
                        })
                    }
                }, function() {
                    var e = "Sending failed, try again...";
                    modalContainer(e), console.error(e)
                })
            }, 150)
        },
        m = $("#project-search"),
        h = $('input[name="project-id"]');
    if (m.length) {
        var v = null,
            g = "";
        m.css({
            cursor: "pointer"
        }).focus(function() {
            g = m.val(), m.val("")
        }).focusout(function() {
            m.val().length || m.val(g)
        }).keyup(function() {
            h.val("0");
            var e = $(this).val();
            clearTimeout(v), v = setTimeout(function() {
                $.ajax({
                    url: URL_BASE + "ERPModule/Projects/SearchProject/",
                    type: "post",
                    data: {
                        "search-project-query": e
                    },
                    success: function(e) {
                        m.closest("div").children("div").remove();
                        var t = m.after("<div></div>").next("div");
                        t.css({
                            display: "block",
                            position: "absolute",
                            border: "1px solid #349173",
                            background: "#FFF"
                        });
                        var a = "";
                        a = "empty" === e ? "No Projects" : "failed" === e ? "Search Failed" : JSON.parse(e), "string" == typeof a ? t.html('<div style="padding: 4px 8px;">' + a + "</div>").click(function() {
                            t.remove()
                        }) : $.each(a, function(e) {
                            var i = a[e];
                            t.append('<div class="selectable" style="padding: 2px 5px; border-bottom: 1px solid #000;">Project #' + i.id + " | " + i.name + "</div>"), t.children("div:last-child").css({
                                cursor: "pointer"
                            }).click(function(e) {
                                e.preventDefault();
                                var a = $(this).html();
                                h.val(i.id), m.val(a).attr("title", a).css({
                                    "border-color": "#0dba3e"
                                }), t.remove()
                            })
                        })
                    },
                    error: function() {}
                })
            }, 600)
        })
    }
    e.unbind().submit(function(e) {
        if (e.preventDefault(), $("#is_travel_request").is(":checked")) {
            var t = p();
            t === !0 && f()
        } else {
            var t = u();
            if (t === !1) return !1;
            if ("undefined" != typeof t.hasFare && t.hasFare === !0) {
                var a = "";
                $.each(t.travelRelated_expenses, function(e, t) {
                    a += '<li><div style="font-size: 1.15em;">' + e + '</div><ol type="1">', $.each(t, function(e, t) {
                        a += "<li>" + t + "</li>"
                    }), a += "</ol></li>"
                }), a = '<ol type="A">' + a + "</ol>", modalContainer('<div style="display: inline-block; margin: 0px 0px 10px 0px;">You have a travel-related expense in your Budget Allocations. Please confirm that this is a Budget Request, and if not, please indicate that this is a Travel Request on the General Information section.</div><br />' + a, "Request Type Confirmation", {
                    "CONFIRM that this is a Budget Request": function() {
                        f()
                    },
                    "CANCEL the sending to change the request into a Travel Request": ""
                })
            } else f()
        }
    }), a.find(".allocations").before('<div style="margin: 0px 0px 5px 0px;padding: 0px 8px;border-bottom: 3px double #333;white-space: nowrap;color: #333;"><h3 style="display: inline-block;width: 372px;margin: 0px 0px 5px 0px;font-weight: normal;overflow: hidden;">Description</h3><h3 style="display: inline-block;width: 88px;margin: 0px 0px 5px 0px;font-weight: normal;overflow: hidden;">From</h3><h3 style="display: inline-block;width: 88px;margin: 0px 0px 5px 0px;font-weight: normal;overflow: hidden;">To</h3><h3 style="display: inline-block;width: 90px;margin: 0px 0px 5px 0px;font-weight: normal;overflow: hidden;">Amount</h3><h3 style="display: inline-block;margin: 0px 10px 5px 0px;font-weight: normal;overflow: hidden;">Currency</h3><h3 style="display: inline-block;margin: 0px 0px 5px 0px;font-weight: normal;overflow: hidden;">Category</h3></div>');
    var b = $("#budget-request-advises");
    try {
        var y = JSON.parse(b.html());
        b.show(0).css({
            "margin-bottom": "10px"
        }).html('<div><h3 style="margin: 0px 0px 10px 0px; font-weight: normal; color: #333;">Guidelines (<div style="display: inline; color: #e20b0b;">Please read</div>):</h3><div style="margin: 0px 0px 10px 0px;">Click the images for a clearer view of the sample.</div><div style="margin: 0px 0px 10px 0px; white-space: nowrap;"><div style="display: inline-block; vertical-align: top;">Avoid creating an allocation that combines all allocations.<br />Sample of an <div style="display: inline; color: #e20b0b;">incorrect</div> enumeration of particulars:<br /><img class="advise-image" src="' + y.wrong + '" /></div><div style="display: inline-block; vertical-align: top; margin-left: 10px; padding-left: 10px; border-left: 1px solid #333;">As much as possible, enumerate each allocation in this section.<br />Sample of a <div style="display: inline; color: #03b203;">correct</div> enumeration of particulars:<br /><img class="advise-image" src="' + y.correct + '" /></div></div></div>').find(".advise-image").css({
            width: "400px",
            height: "auto",
            margin: "10px 0px 0px 0px",
            cursor: "pointer"
        }).click(function() {
            var e = $(this),
                t = e.attr("src");
            modalContainer('<img class="image-preview" src="' + t + '" />', "Image Preview"), $("#modal-container").find(".image-preview").css({
                opacity: "1"
            })
        })
    } catch (x) {
        console.error(x)
    }
}

function requestForm_travelRequest() {
    var e = $("#is_travel_request"),
        t = e.parent(),
        a = $("#fieldset-travel-request"),
        i = $("#travel_type"),
        n = $('#travel_type, [for="travel_type"]').wrapAll("<div></div>").parent(),
        r = $('#training_reecho_date, [for="training_reecho_date"], #training_reecho_venue, [for="training_reecho_venue"]'),
        o = $("#training_host").parent(),
        l = $("#training_reecho_date"),
        s = $('select[name="is_travel_request_selector"]');
    e.hide(0), a.css({
        "max-width": $("#fieldset-allocations-box").width() + 23 + "px"
    }), n.find('[data-value="training"], [data-value="travel"]').css({
        display: "block",
        "text-align": "left"
    }), s.change(function() {
        var t = $(this).val(),
            i = $("#budget-travel-request-type-label"),
            n = $('input[type="submit"][name="submitbtn"]'),
            r = "tr" === t ? "Travel" : "Budget";
        i.length && i.html(r), "Travel" == r ? (e.prop("checked", !0), a.stop().slideDown("fast"), n.val("Send Travel Request")) : (e.prop("checked", !1), a.stop().slideUp("fast"), n.val("Send Budget Request"))
    }), l.initiateDatepicker(), a.show(0).slideUp(0), t.show(0), e.click(function() {
        return !0
    }), i.change(function() {
        switch ($(this).val()) {
            case "training":
                r.show(0), o.show(0);
                break;
            case "travel":
                r.hide(0), o.hide(0)
        }
    }).trigger("change");
    var d = $("#immediate_heads_container"),
        c = $('[name="immediate_heads_txtbox"]');
    textboxSearch(c, {
        url: URL_BASE + "ERPModule/Requests/Travels/Actions/EmailIdentity/"
    }, function(e) {
        c.val("").focus(), requestForm_travelRequest_ImmediateHead(e.email)
    });
    var u = d.attr("data-immediate-heads");
    u.length && (u = u.split(","), $.each(u, function(e, t) {
        requestForm_travelRequest_ImmediateHead($.trim(t))
    })), requestForm_travelRequest_DateVenues(), requestForm_travelRequest_Participants()
}

function requestForm_travelRequest_DateVenues() {
    var e = $('[name="venue[]"]').closest("tbody"),
        t = e.html(),
        a = function() {
            e.append(t);
            var i = e.children("tr:last-child"),
                n = i.find('[name="venue[]"]'),
                r = i.find('[name="date_from[]"]'),
                o = i.find('[name="date_to[]"]'),
                l = i.find('[name="venue[]"]');
            dateRangeRestrict(r, o), n.before('<div class="rowRemoveButton icon-erp-clickable icon-erp-x-dark" style="display: inline-block; margin: 5px 5px 0px 0px;"></div>').on("keyup", function() {
                var t = n.val();
                t.length ? (n.removeClass("empty"), e.find(".empty").length || a()) : n.addClass("empty")
            }).blur(function() {
                e.find(".empty").length > 1 && i.remove()
            }), i.find('[name="date_from[]"], [name="date_to[]"]').initiateDatepicker().addClass("datepicker"), i.find(".rowRemoveButton").click(function() {
                i.remove(), e.children("tr").length || a()
            }), textboxSearch(l, {
                url: URL_BASE + "/ERPModule/Requests/Travels/Actions/EnteredVenues/"
            }, function(e) {
                l.val(e.display).blur()
            })
        };
    e.html(""), a()
}

function requestForm_travelRequest_ImmediateHead(e) {
    var t = $("#immediate_heads_display");
    if (e = $.trim(e), t.find('[data-email="' + e + '"]').length) return !0;
    t.append('<div class="immediate-head-display align-left align-top" style="padding: 3px 9px; margin: 0px 1px 1px 0px; border-radius: 3px; background: #357ab2; color: #fff;" data-email="' + e + '"><div class="x-button icon-erp-clickable icon-erp-x-light" style="margin-right: 5px;"></div>' + e + "</div>"), requestForm_travelRequest_ImmediateHead_Update();
    var a = t.children("div:last-child");
    a.children(".x-button").click(function() {
        a.remove(), requestForm_travelRequest_ImmediateHead_Update()
    })
}

function requestForm_travelRequest_ImmediateHead_Update() {
    var e = "",
        t = $("#immediate_heads_container"),
        a = t.find("#immediate_heads_display"),
        i = t.find('[name="immediate_heads"]');
    a.children("[data-email]").each(function() {
        e.length && (e += ", "), e += $(this).attr("data-email")
    }), i.val(e);
}

function requestForm_travelRequest_Participants() {
    var e = $('[name="participants_email[]"]').closest("tbody"),
        t = e.closest("table"),
        a = e.html(),
        i = t.attr("data-user-email"),
        n = t.attr("data-user-realname"),
        r = function() {
            e.append(a);
            var t = e.children("tr:last-child"),
                i = t.find('[name="participants_email[]"]');
            i.addClass("empty").on("keyup change", function() {
                var t = i.val();
                t.length ? (i.removeClass("empty"), e.find(".empty").length || r()) : i.addClass("empty"), i.css({
                    "border-color": "#1395d6",
                    "background-color": "#fff",
                    color: "#000"
                })
            }).blur(function() {
                e.find(".empty").length > 1 && t.remove()
            }).before('<div class="rowRemoveButton icon-erp-clickable icon-erp-x-dark" style="display: inline-block; margin: 5px 5px 0px 0px;"></div>').prev(".rowRemoveButton").click(function() {
                t.find(".empty").length || t.remove(), e.children("tr").length || r()
            }), textboxSearch(i, {
                url: URL_BASE + "/ERPModule/Requests/Travels/Actions/EmailIdentity/"
            }, function(e) {
                i.val(e.email).blur().css({
                    "border-color": "#2d7f26",
                    "background-color": "#daffd8",
                    color: "#2d7f26"
                }), t.children("td:nth-child(2)").html(e.realname)
            })
        };
    e.html(""), r(), e.children("tr:first-child").find('[name="participants_email[]"]').val(i).css({
        "border-color": "#2d7f26",
        "background-color": "#daffd8",
        color: "#2d7f26"
    }).removeClass("empty"), e.children("tr:first-child").children("td:nth-child(2)").html(n), r()
}

function requestForm_travelRequestUpdate(e) {
    $("#is_travel_request").prop("checked", !0).closest("div").hide(0).after("<div></div>").next("div").css({
        "max-width": "680px",
        margin: "0px 0px 20px 0px",
        color: "#006ac1"
    }).html("NOTE: This is a Travel Request and you can no longer revise this request into a Budget Request.<br />Should you wish to create a Budget Request with the same information, cancel this request and create a new Budget Request."), $("#fieldset-travel-request").stop(!0, !0).slideDown("fast"), $('select[name="is_travel_request_selector"]').val("tr"), 1 == e.training_present_work_requirement && $("#training_present_work_requirement").trigger("click"), 1 == e.training_prospective_dept_requirement && $("#training_prospective_dept_requirement").trigger("click"), 1 == e.training_career_opportunities && $("#training_career_opportunities").trigger("click"), 1 == e.training_dept_needs && $("#training_dept_needs").trigger("click"), 1 == e.budget_cash_advance && $("#budget_cash_advance").trigger("click"), 1 == e.budget_personal_expense && $("#budget_personal_expense").trigger("click"), $("#travel_type").val(e.travel_type).trigger("change"), $("#travel_title").val(e.travel_title), $("#travel_category").val(e.travel_category), null === e.training_reecho_date ? $("#training_reecho_date").val("0000-00-00") : $("#training_reecho_date").val(e.training_reecho_date), $("#training_reecho_venue").val(e.training_reecho_venue), $("#travel_purpose").val(e.travel_purpose), $("#training_host").val(e.training_host), $("#budget_sponsor").val(e.budget_sponsor), $("#transport_plate").val(e.transport_plate), $("#transport_driver").val(e.transport_driver);
    var t = e.immediate_heads.split(",");
    if ($.each(t, function(e, t) {
            t = $.trim(t), t.length && (requestForm_travelRequest_ImmediateHead(t), console.log("Email: " + t))
        }), e.venues.length) {
        var a = $('[name="venue[]"]').closest("tbody");
        $.each(e.venues, function(e, t) {
            var i = a.children("tr:last-child");
            i.find('[name="date_from[]"]').val(t.date_from), i.find('[name="date_to[]"]').val(t.date_to), i.find('[name="venue[]"]').val(t.venue).trigger("keyup")
        })
    }
    if (e.participants.length) {
        var a = $('[name="participants_email[]"]').closest("tbody");
        a.find(".rowRemoveButton").trigger("click"), $.each(e.participants, function(e, t) {
            var i = a.children("tr:last-child"),
                n = i.children("td:nth-child(2)");
            null === t.name && (t.name = "N/A"), i.find('[name="participants_email[]"]').val(t.email).trigger("change"), n.html(t.name)
        })
    }
}

function requestForm_wizard() {
    return console.log("Wizard form for Budget Request has been disabled."), !0
}

function requestFormAction(e) {
    var t = e.closest("form"),
        a = e.html(),
        i = $("#container-approval-mail-errors"),
        n = function() {
            e.append(a);
            var t = e.children("div:last-child"),
                i = t.find(".container-email-name"),
                r = t.find('[name="addtnlapprvl[]"]'),
                o = '<input class="btn-remove-email" type="button" value="X" style="width: 15px; height: 15px; margin: 0px 7px 1px 0px; padding: 0px; border-width: 0px; font-size: 0.85em;" />';
            t.attr("data-is-empty", 1), textboxSearch(r, {
                url: URL_BASE + "ERPModule/Users/SearchAuthorizers/"
            }, function(e) {
                i.html(o + e.realname), r.val(e.email).prop("readonly", !0);
                var a = i.find(".btn-remove-email");
                a.click(function() {
                    t.remove()
                })
            }), r.keyup(function() {
                var a = $.trim(r.val());
                a.length && t.attr("data-is-empty", 0), e.find('[data-is-empty="1"]').length || n()
            }).on("click focusin", function() {
                return r.prop("readonly") ? !1 : void 0
            }).focusout(function() {
                if (r.val().length || 1 == t.attr("data-is-empty")) {
                    if (1 != t.attr("data-is-empty")) {
                        i.html(o);
                        var e = i.find(".btn-remove-email");
                        e.click(function() {
                            t.remove()
                        })
                    }
                } else t.remove()
            })
        };
    e.html(""), n(), e.click(function() {
        i.is(":visible") && i.slideUp(i.offsetHeight)
    }), t.submit(function(a) {
        if (a.preventDefault(), 1 == t.attr("was-submitted")) return !1;
        t.attr("was-submitted", 1);
        var n = 0,
            r = t.find('input[type="submit"]'),
            o = {};
        o.emails = [], o.reasons = [], o.notes = $("#action-notes").val(), o.action = t.find('[name="action"]').val(), o.submitbtn = r.val(), r.hide(0), e.children("div").each(function() {
            var e = $(this),
                t = e.find('[name="addtnlapprvl[]"]').val(),
                a = e.find('[name="addtnlapprvl_reasons[]"]').val();
            t.length && (o.emails.push(t), o.reasons.push(a), n++)
        }), n ? $.ajax({
            url: t.attr("action"),
            type: "post",
            data: o,
            success: function(e) {
                r.show(0);
                try {
                    if (result = JSON.parse(e), "success" == result.status) {
                        var a = $("#rendered-request-container");
                        t.html("The approving bodies were successfully added. The new Budget Request has been displayed below for checking.").closest("div").prev("div").slideUp(), a.prepend('<h3 style="margin: 0px 0px 10px 0px; font-weight: normal;">Added Approvals:</h3><div style="margin: 0px 0px 10px 0px; padding: 0px 0px 10px 0px; border-bottom: 1px dashed #333;">' + result.html + '</div><h3 style="margin: 20px 0px 0px 0px; font-weight: normal;">Previous State:</h3>')
                    }
                } catch (n) {
                    i.slideDown(i.offsetHeight).html(e), t.removeAttr("was-submitted")
                }
            },
            error: function() {
                r.show(0), t.removeAttr("was-submitted")
            }
        }) : (r.show(0), t.removeAttr("was-submitted"), i.slideDown(i.offsetHeight).html("You're required to provide at least 1 email that is to be added as an approving body before your approval."), e.children("div:last-child").find('[name="addtnlapprvl[]"]').focus())
    })
}
